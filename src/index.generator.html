<!DOCTYPE html>
<html>
<head>
<title>Bash to ShellJS Translator</title>
<script src="node_modules/ohm-js/dist/ohm.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/ohm-js" src="src/bash.ohm"></script>
<script src="src/semantics.js"></script>
<style>
textarea {
  overflow-x: scroll;
  overflow-y: scroll;
}
</style>
</head>
<body>
<h1>Bash to ShellJS Translator</h1>
<div>
<textarea id="bashcode" spellcheck="false" cols="80" rows="20" wrap="off">
echo "Type something in this box, or paste in a simple shell script"
</textarea>
<input type="checkbox" name="globalInclude" id="checkbox1" checked>Include in global namespace
<script>
var bash = ohm.grammarFromScriptElement();
var s = bash.semantics();
var errMessage;
var warned = false;
s.addOperation(
  'toJS(indent)',
  source2sourceSemantics);

function loadTranslatedText() {
  globalInclude = document.getElementById('checkbox1').checked
  var script = document.getElementById('bashcode').value.trim() + '\n';
  var m = bash.match(script);
  errMessage = m.failed() ? m.message : null;
  warned = false;
  if (!errMessage) {
    var n = s(m);
    var replacementText = n.toJS(0);
    document.getElementById('jscode').innerHTML = replacementText;
  }
}
$('#bashcode').keyup(loadTranslatedText);
$('#checkbox1').change(loadTranslatedText);
$('document').ready(loadTranslatedText);
var timeout;
$('#bashcode').keypress(function() {
  if(timeout) {
    clearTimeout(timeout);
    timeout = null;
  }
  timeout = setTimeout(function() {
    if (errMessage) {
      console.error(errMessage);
      warned = true;
    }
  }, 3000);
});
</script>

</div>
<div>
<textarea id="jscode" spellcheck="false" cols="80" rows="20" wrap="off" readonly>
</textarea>
<input type="button" value="Select all" onclick="selectAll()" id="button1">
</div>
<script>
function selectAll() {
  document.getElementById('jscode').select();
}
</script>
</body>
</html>
